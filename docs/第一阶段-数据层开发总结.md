# 第一阶段：数据层开发总结

## 一、阶段目标

完成数据集构建与预处理，生成标准化的CSV格式数据集，为后续算法训练提供高质量数据基础。

## 二、完成内容

### 1. 数据集获取与分析

#### 使用数据源
- **主数据集**：IoT-23 公开数据集
- **数据文件**：`conn.log.labeled`（Zeek格式连接日志）
- **原始样本量**：约32万条记录

#### 数据字段分析
原始数据包含23个字段，核心字段包括：
- `ts`：时间戳
- `id.orig_h` / `id.resp_h`：源IP / 目的IP
- `id.orig_p` / `id.resp_p`：源端口 / 目的端口
- `proto`：协议类型（TCP/UDP/ICMP）
- `duration`：连接持续时间
- `orig_bytes` / `resp_bytes`：发送/接收字节数
- `orig_pkts` / `resp_pkts`：发送/接收数据包数
- `label`：标签（Benign/Malicious）
- `detailed-label`：详细攻击类型

### 2. 数据预处理流程

#### 2.1 格式转换
- 将Zeek日志格式转换为标准CSV格式
- 统一字段命名规范

#### 2.2 数据清洗
- **缺失值处理**：数值字段填充0，分类字段填充'unknown'
- **异常值处理**：使用IQR方法处理极端值
- **数据去重**：移除完全重复的记录
- **非数值编码**：协议类型等分类特征进行Label Encoding

#### 2.3 特征工程
提取并保留8个核心特征：

| 特征名 | 说明 | 类型 |
|--------|------|------|
| duration | 连接持续时间 | 数值 |
| orig_bytes | 源端发送字节数 | 数值 |
| resp_bytes | 目的端响应字节数 | 数值 |
| orig_pkts | 源端发送数据包数 | 数值 |
| resp_pkts | 目的端响应数据包数 | 数值 |
| proto_encoded | 协议类型编码 | 类别 |
| bytes_ratio | 发送/接收字节比 | 衍生 |
| pkts_ratio | 发送/接收包数比 | 衍生 |

#### 2.4 样本平衡
- 正常样本：80%
- 异常样本：20%
- 最终样本量：10,000条

### 3. 输出文件

```
data/
├── raw/                          # 原始数据目录
├── processed/                    # 处理后数据目录
│   └── iot23_processed.csv      # 预处理后的数据集
├── data_loader.py               # 数据加载模块
├── data_preprocessor.py         # 数据预处理模块
├── feature_engineer.py          # 特征工程模块
├── data_generator.py            # 模拟数据生成模块
└── __init__.py
```

### 4. 数据集统计

| 指标 | 数值 |
|------|------|
| 总样本数 | 10,000 |
| 特征数量 | 8 |
| 正常样本 | 8,000 (80%) |
| 异常样本 | 2,000 (20%) |
| 攻击类型 | DDoS、端口扫描、越权访问、异常指令 |

## 三、关键代码模块

### 3.1 数据预处理器 (`data_preprocessor.py`)
- 数据加载与格式转换
- 缺失值/异常值处理
- 特征标准化

### 3.2 特征工程模块 (`feature_engineer.py`)
- 特征提取与选择
- 特征重要性分析
- 衍生特征计算

### 3.3 数据生成器 (`data_generator.py`)
- 模拟正常智能家居流量
- 模拟4类攻击流量
- 支持自定义样本比例

## 四、验证结果

- ✅ 数据格式统一为CSV
- ✅ 无缺失值和重复记录
- ✅ 特征维度合理（8维）
- ✅ 样本配比符合要求（80:20）
- ✅ 覆盖4类核心威胁类型

## 五、后续衔接

数据层输出的 `iot23_processed.csv` 将作为第二阶段算法层的训练数据输入。
